<!doctype html><html>
<head>
<title>Trying out Rancher</title>
<meta charset=utf-8>
<meta name=X-UA-Compatible content="IE=edge">
<meta name=google-site-verification content>
<meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport>
<style>body{max-width:800px;margin:auto;line-height:1.6;font-size:18px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}.nav a,.nav a:visited,.nav a:hover,.nav a:active{color:inherit}.nav .title{margin:0}.nav-sub{display:inline-block}.nav-item{margin:5px}.nav-sub-right{display:inline-block;float:right}.nav-icon{margin-right:5px}.main img{display:block;max-width:100%;margin:auto}.main pre{overflow:auto}" media="screen"></style>
</head>
<body>
<div class=nav>
<a href=/><h2 class=title>Andra≈æ Bajt's blog</h2></a>
<div class=nav-sub>
<a class=nav-item href=/about>
About Me
</a>
<a class=nav-item href=/>
Archive
</a>
</div>
<div class=nav-sub-right>
<a class=nav-icon href=https://github.com/edofic target=_blank><img src=/icons/github.svg width=20 height=20></a>
<a class=nav-icon href=https://www.linkedin.com/in/edofic target=_blank><img src=/icons/linkedin.svg width=20 height=20></a>
<a class=nav-icon href=https://twitter.com/edofic target=_blank><img src=/icons/twitter.svg width=20 height=20></a>
<a class=nav-icon href=/index.xml target=_blank><img src=/icons/rss.svg width=20 height=20></a>
<a class=nav-icon href=mailto:blog@edofic.com target=_blank><img src=/icons/email.svg width=20 height=20></a>
</div>
</div>
<hr>
<div class=main>
<h1>Trying out Rancher</h1>
<time>2021-04-14</time>
<a href=/tags/trying-out>trying-out</a>
<hr>
<p>This time it&rsquo;s a bit different: this post has very little code and a lot of
screenshots as I was primarily working with a GUI.</p>
<p>Reading about (and working with) <a href=https://k3s.io/>K3s</a> is almost impossible to
not hear about <a href=https://rancher.com/>Rancher</a> - the company behind K3s. But
what had me slightly confused is their primary product: <a href=https://rancher.com/products/rancher/>Rancher (the
software)</a>.</p>
<p>The web page says</p>
<blockquote>
<p>Managed Kubernetes Cluster Operations</p>
</blockquote>
<p>but that doesn&rsquo;t really tell me much. Neither do their presentations. So what
better way to get a feel for it than taking it for a spin :) (there is some
enterprise offerings but the base product is free).</p>
<h1 id=getting-started>Getting started</h1>
<p>After clicking the fetching <a href=https://rancher.com/quick-start/>Getting Started</a>
button I&rsquo;m presented with these rather short instructions:</p>
<p><img src=/images/rancher/01.png alt="getting started"></p>
<p>Ok, prerequisites first. I spun up a new VM on <a href=https://www.digitalocean.com/>Digital
Ocean</a> and selected Ubuntu 20.04 (which is on the
list of supported distros and is not ancient), 8gb of ram and 4 vCPUs -
completely guessing here - no idea what I actually need I picked a &ldquo;smallish VM
that should still handle any reasonable application&rdquo;.</p>
<p>Second step is getting <a href=https://www.docker.com/>docker</a> on my machine, this is
where picking Ubuntu comes in handy:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>snap install docker
</code></pre></td></tr></table>
</div>
</div><p>Just a few minutes later I can actually proceed onto actually running rancher
via docker:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>docker run --privileged -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher
</code></pre></td></tr></table>
</div>
</div><p>And just like that we&rsquo;re up and listening on port 80!</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>root@ubuntu-s-4vcpu-8gb-amd-fra1-01:~# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                                      NAMES
89ffd60c0892        rancher/rancher     &#34;entrypoint.sh&#34;     16 seconds ago      Up 15 seconds       0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp   sweet_cannon
r
</code></pre></td></tr></table>
</div>
</div><h1 id=first-impressions>First impressions</h1>
<p>I navigate to port 80 of my new VM from my laptop and I&rsquo;m greeted with a first
time setup. Nice :)</p>
<p><img src=/images/rancher/02.png alt="initial setup"></p>
<p>Let&rsquo;s go with multiple clusters, to see what this is all about.</p>
<p><img src=/images/rancher/03.png alt="global dashboard"></p>
<p>Huh. Apparently we got a local K3s cluster as well. I&rsquo;m guessing &ldquo;local&rdquo; means
it&rsquo;s running on the same VM (there is no real other option anyway).</p>
<p>I&rsquo;m wondering if you can also install rancher on an existing cluster. Quick
search suggests the answer <a href=https://rancher.com/docs/rancher/v2.x/en/installation/install-rancher-on-k8s/>is
yes</a>.</p>
<p>What happens if I click on &ldquo;local&rdquo;?</p>
<p><img src=/images/rancher/04.png alt=04.png></p>
<p>Vaguely reminiscent of <a href=https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/>K8s Web
UI</a>. Looks useful.</p>
<h1 id=creating-clusters>Creating clusters</h1>
<p>But I&rsquo;m not interested in a dashboard for a K3s instance - I want to try setting
up some clusters :D Let&rsquo;s try clicking add cluster.</p>
<p><img src=/images/rancher/05.png alt=05.png></p>
<p>That&rsquo;s quite a list of providers already. Quite intriguing one is &ldquo;Existing
nodes&rdquo;. Also interesting to me is the ability to connect managed clusters. You
really do get one central management tool for all your clusters. Huh you can
even automatically provision VMs on vSphere. But I&rsquo;m going with DigitalOcean
today as this is where I&rsquo;m doing my experiment. A happy accident really -
haven&rsquo;t checked what is supported upfront.</p>
<p>But I did do some digging at this point and apparently you can install extra
(even 3rd party) providers to extend this. E.g. I&rsquo;ve found <a href=https://jmrobles.medium.com/how-to-create-a-kubernetes-cluster-with-rancher-on-hetzner-3b2f7f0c037a>this tutorial</a> for setting up a cluster on <a href=https://www.hetzner.com/>Hetzner</a> - which is another provider I sometimes use for my projects. Liking this extensibility a lot.</p>
<p><img src=/images/rancher/06.png alt=06.png></p>
<p>First I need to configure a template for my nodes (since this is the first
time and I don&rsquo;t have any?). I&rsquo;m going with something small as I don&rsquo;t have
plans for any substantial workloads on this cluster.</p>
<p>Note: I was also prompted to configure DO integration at this point by providing
an API token - no magic integration but super straightforward.</p>
<p><img src=/images/rancher/07.png alt=07.png></p>
<p>Time to setup my node pools now. If I&rsquo;m reading this right I&rsquo;m configuring how
many VMs of what template to run and what services to run on them. There&rsquo;s even
validation (green checkmarks) that I have a setup that yields a functional
cluster. I won&rsquo;t bother with other options, let&rsquo;s just take defaults out for a
spin.</p>
<p><img src=/images/rancher/08.png alt=08.png></p>
<p>And now we wait&mldr;.</p>
<p>Meanwhile in DO console I can see droplets coming up</p>
<p><img src=/images/rancher/09.png alt=09.png></p>
<p>After about 10min the cluster reports as &ldquo;active&rdquo;. Great success!</p>
<p><img src=/images/rancher/11.png alt=11.png></p>
<p>Clicking that I get an overview of my new nodes</p>
<p><img src=/images/rancher/12.png alt=12.png></p>
<p>And some management too</p>
<p><img src=/images/rancher/13.png alt=13.png></p>
<p>Doesn&rsquo;t seem much&mldr;but stop to think about it for a moment. This abstracts over
the underlying compute provider which is great if you&rsquo;re running multiple
clusters on a mix (e.g. AWS + on prem).</p>
<p>I can also pick &ldquo;namespaces&rdquo; from the menu and get an overview of k8s namespaces
on my cluster.</p>
<p><img src=/images/rancher/14.png alt=14.png></p>
<p>And yes - there is still the dashboard.</p>
<p><img src=/images/rancher/15.png alt=15.png></p>
<p>One interesting difference pops out: we&rsquo;re not running K3s anymore but
<a href=https://rancher.com/products/rke/>RKE</a> - Rancher Kubernetes Engine.</p>
<blockquote>
<p>RKE is a CNCF-certified Kubernetes distribution that runs entirely within
Docker containers. It solves the common frustration of installation complexity
with Kubernetes by removing most host dependencies and presenting a stable
path for deployment, upgrades, and rollbacks.</p>
</blockquote>
<p>The key point here is that we got what is basically a managed cluster (k8s as
a service) using only a compute provider (yes I know DO also offers managed k8s
but that a different beast altogether).</p>
<h1 id=features>Features</h1>
<p>With a few more clicks I got a metrics stack installed in the cluster and now
have more detailed stats.</p>
<p><img src=/images/rancher/16.png alt=16.png></p>
<p>And a configured grafana instance too!</p>
<p><img src=/images/rancher/17.png alt=17.png></p>
<p>I can get a kubeconfig file directly from the UI and use it to connect to my new
cluster like any other cluster</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>andraz@amaterasu /tmp
 $ export KUBECONFIG=$(pwd)/kubeconfig
andraz@amaterasu ~
 $ kubectl get nodes
NAME   STATUS   ROLES                      AGE   VERSION
sb2    Ready    controlplane,etcd,worker   10m   v1.20.5
sb3    Ready    controlplane,etcd,worker   10m   v1.20.5
sb4    Ready    controlplane,etcd,worker   10m   v1.20.5
</code></pre></td></tr></table>
</div>
</div><p>But if I cannot be bothered and just want to poke around a bit there is even a
convenient web-based shell</p>
<p><img src=/images/rancher/18.png alt=18.png></p>
<h1 id=apps>Apps</h1>
<p>Moving on the last element I see in the UI - Apps</p>
<p><img src=/images/rancher/19.png alt=19.png></p>
<p>Looks like some form of prepackaged software.</p>
<p><img src=/images/rancher/20.png alt=20.png></p>
<p>Digging deeper confirms this is in fact a UI for <a href=https://helm.sh/>helm</a>
charts.</p>
<p><img src=/images/rancher/21.png alt=21.png></p>
<p>Let&rsquo;s configure a Wordpress instance then. This should be a nice test if our
cluster is in fact fully functional and provides all we could possibly want</p>
<p><img src=/images/rancher/22.png alt=22.png></p>
<p>Takes a moment to deploy the chart. I can now zoom in and see the actual
deployment in action</p>
<p><img src=/images/rancher/23.png alt=23.png></p>
<p>Few more minutes and we&rsquo;re green.</p>
<p><img src=/images/rancher/24.png alt=24.png></p>
<p>A quick <code>/etc/hosts</code> edit later I&rsquo;m accessing my WP instance. I&rsquo;m pointing my
browser at one of the nodes where I&rsquo;m hitting an ingress controller that routes
to an internal service based on the virtual host (hence <code>/etc/hosts</code> edit) that
routes to the actual pod running somewhere in the cluster.</p>
<p><img src=/images/rancher/25.png alt=25.png></p>
<h1 id=removing-a-cluster>Removing a cluster</h1>
<p>That was enough fun. Let&rsquo;s tear the cluster down to see if it cleans up after
itself.</p>
<p><img src=/images/rancher/26.png alt=26.png></p>
<p>Entered a &ldquo;Removing&rdquo; state</p>
<p><img src=/images/rancher/27.png alt=27.png></p>
<p>and few moments later is gone. So are all the traces from my DO dashboard.</p>
<h1 id=closing-thoughts>Closing thoughts</h1>
<p>I think I get &ldquo;managed kuberenetes cluster operations&rdquo; now. Provisioning,
monitoring, day 2 ops, running some common workloads. Seems like the primary use
case is managing multiple clusters but it&rsquo;s also an interesting alternative for
providing &ldquo;managed&rdquo; clusters in places where you don&rsquo;t have this option.</p>
<hr>
<p>Last modified on 2021-04-14</p>
<a href=/posts/2021-02-27-trying-out-okteto-cloud/>
Previous Trying out Okteto Cloud
</a>
<br>
<a href=/posts/2021-04-15-trying-microk8s/>
Next Trying out Microk8s
</a>
</div>
<script src=/js/instantclick.min.js data-no-instant></script>
<script data-no-instant>InstantClick.init("mousedown")</script>
</body>
</html>