<!doctype html><html><head><title>Generic singletons through dependent method types</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><style>body{max-width:800px;margin:auto;line-height:1.6;font-size:18px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}.nav a,.nav a:visited,.nav a:hover,.nav a:active{color:inherit}.nav .title{margin:0}.nav-sub{display:inline-block}.nav-item{margin:5px}.nav-sub-right{display:inline-block;float:right}.nav-icon{margin-right:5px}.main img{display:block;max-width:100%;margin:auto}.main pre{overflow:auto}" media="screen"></style></head><body><div hx-boost=true hx-ext=preload><div class=nav preload=mousedown><a href=/><h2 class=title>Andraž Bajt's blog</h2></a><div class=nav-sub><a class=nav-item href=/about/>About Me</a>
<a class=nav-item href=/>Archive</a></div><div class=nav-sub-right><a class=nav-icon href=https://github.com/edofic target=_blank><img src=/icons/github.svg width=20 height=20></a>
<a class=nav-icon href=https://www.linkedin.com/in/edofic target=_blank><img src=/icons/linkedin.svg width=20 height=20></a>
<a class=nav-icon href=https://twitter.com/edofic target=_blank><img src=/icons/twitter.svg width=20 height=20></a>
<a class=nav-icon href=/index.xml target=_blank><img src=/icons/rss.svg width=20 height=20></a>
<a class=nav-icon href=mailto:blog@edofic.com target=_blank><img src=/icons/email.svg width=20 height=20></a></div></div><hr><div class=main preload=mousedown><h1>Generic singletons through dependent method types</h1><time>2013-01-27</time><hr><p>Ever
tried to write a
<a href=http://en.wikipedia.org/wiki/Generic_programming title="Generic programming">generic</a>
singleton? It&rsquo;s an oxymoron of a sort. But sometimes my brain dreams up
funny concepts to solve the problem at hand. Sadly I cannot remember
what I wanted to use them for. Anyway I think I just made all the
<a href=http://en.wikipedia.org/wiki/Method_%28computer_programming%29 title="Method (computer programming)">methods</a>
generic and solved it this way. But this doesn&rsquo;t really express the
notion of one entity that&rsquo;s agnostic to type of the parameters. With
generic methods you get a bunch of disconnected units - at least that&rsquo;s
the picture in my head.</p><h3 id=general>General</h3><p><img src=http://farm8.static.flickr.com/7192/6857158741_a4e3d23649_m.jpg alt="Challenge Accepted!" title="Challenge Accepted!"></p><p>So we&rsquo;ve
established that generic singletons are just a silly idea, now let&rsquo;s try
to implement it - you know &ldquo;Challenge accepted!&rdquo; style.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span> <span style=color:#75715e>//error: &#39;;&#39; expected but &#39;[&#39; found.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>def</span> id<span style=color:#f92672>(</span>a<span style=color:#66d9ef>:</span><span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> a
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Luckily this naive approach does not compile. Try it.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> id<span style=color:#f92672>(</span>a<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> a
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</span></span></code></pre></td></tr></table></div></div><p>But this is not a singleton anymore as there is a new instance created
everytime.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Instance</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#a6e22e>private</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Singleton</span><span style=color:#f92672>]</span> <span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> id<span style=color:#f92672>(</span>a<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> a
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Singleton</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>val</span> cache <span style=color:#66d9ef>=</span>
</span></span><span style=display:flex><span>    collection<span style=color:#f92672>.</span>mutable<span style=color:#f92672>.</span><span style=color:#a6e22e>HashMap</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Class</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>,<span style=color:#66d9ef>Instance</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]]()</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]()(</span><span style=color:#66d9ef>implicit</span> m<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Manifest</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>=</span>
</span></span><span style=display:flex><span>    cache<span style=color:#f92672>.</span>getOrElseUpdate<span style=color:#f92672>(</span>m<span style=color:#f92672>.</span>erasure<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Instance</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]).</span>asInstanceOf<span style=color:#f92672>[</span><span style=color:#66d9ef>Instance</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//use as
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>].</span>id<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//and some sugar
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>def</span> singleton<span style=color:#f92672>[</span><span style=color:#66d9ef>A:Manifest</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//now use like
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>singleton<span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>].</span>id<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hi&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Didn&rsquo;t bother with <a href=http://en.wikipedia.org/wiki/Thread_safety title="Thread safety">thread
safety</a>. And
dragging around Manifest just for caching is a bit of a pain, luckily
elevated by context bounds.</p><h3 id=type-specific>Type specific</h3><p>That worked for classes that don&rsquo;t bother about the generic types&mldr;what
if we want specific behavior per type? <a href=http://en.wikipedia.org/wiki/Type_class title="Type class">Type
classes</a>.
A trait for general interface and objects for specific types. Magic lies
in making these objects implicit and having a method that gives you the
right one!</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> f<span style=color:#f92672>(</span>a<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>IntSingleton</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> f<span style=color:#f92672>(</span>n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> n <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>StringSingleton</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> f<span style=color:#f92672>(</span>s<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> s
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> s<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>=</span> s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>].</span>f<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>)</span> <span style=color:#75715e>// == 2
</span></span></span></code></pre></td></tr></table></div></div><h3 id=specific-functionality>Specific functionality</h3><p>Now let&rsquo;s add a little twist.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>IntSingleton</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> f<span style=color:#f92672>(</span>n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> n <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> g<span style=color:#f92672>(</span>n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> n <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//this line doesn&#39;t compile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>].</span>g<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>and it doesn&rsquo;t compile for a reason. <a href=http://en.wikipedia.org/wiki/Type_system title="Type system">Static
type</a> of
returned from Singleton[Int] is Singleton[Int]. And there is no method g
defined in trait Singleton. But we are sure it exists. We could call
IntSingleton directly but this makes whole Singleton abstraction
worthless. Luckily for us scala 2.10 has a feature called method
<a href=http://en.wikipedia.org/wiki/Dependent_type title="Dependent type">dependent
types</a>. To
my best understanding this means support for return types that depend on
the type of parameters. And here we want the type to reflect which
instance is being returned. Nothing suits the job better as singleton
types. Singleton type is a type that has only one value. So an object A
will be of type A.type. This type is worthless for inference but great
when you&rsquo;re doing the type tags. We just need a little fix</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> s<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Singleton</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>s.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> s
</span></span></code></pre></td></tr></table></div></div><p>This method will return the correct instance along with it&rsquo;s type while
giving you a nice abstraction of <a href=http://en.wikipedia.org/wiki/Type_constructor title="Type constructor">type
constructor</a>.
 </p><hr><p>Last modified on 2013-01-27</p><a href=/posts/2013-01-27-monadic-io/>Previous Monadic IO with ScalaZ</a><br><a href=/posts/2013-01-27-chaining-implicits/>Next Chaining implicit conversion in scala</a></div></div><script src=/js/htmx.min.js></script>
<script src=/js/preload.js></script></body></html>