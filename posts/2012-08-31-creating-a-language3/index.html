<!DOCTYPE html>
<html>
<head>
<title>Making a programming language Part 3 - adding features</title>
<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">




<style>body{max-width:800px;margin:auto;line-height:1.6;font-size:18px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}.nav a,.nav a:visited,.nav a:hover,.nav a:active{color:inherit}.nav .title{margin:0}.nav-sub{display:inline-block}.nav-item{margin:5px}.nav-sub-right{display:inline-block;float:right}.nav-icon{margin-right:5px}.main img{display:block;max-width:100%;margin:auto}.main pre{overflow:auto}" media="screen"></style>
</head>
    <body>
        <div class="nav">
            <a href="/"><h2 class="title">Andraž Bajt&#39;s blog</h2></a>
            <div class="nav-sub">
                
                    <a class="nav-item" href="/about/">
                        About Me
                    </a>
                
                    <a class="nav-item" href="/">
                        Archive
                    </a>
                
            </div>
            <div class="nav-sub-right">
                
                    <a class="nav-icon" href="https://github.com/edofic" target="_blank"><img src="/icons/github.svg" width="20" height="20"/></a>
                
                
                    <a class="nav-icon" href="https://www.linkedin.com/in/edofic" target="_blank"><img src="/icons/linkedin.svg" width="20" height="20"/></a>
                
                
                    <a class="nav-icon" href="https://twitter.com/edofic" target="_blank"><img src="/icons/twitter.svg" width="20" height="20"/></a>
                
                <a class="nav-icon" href="/index.xml" target="_blank"><img src="/icons/rss.svg" width="20" height="20"/></a>
                
                    <a class="nav-icon" href="mailto:blog@edofic.com" target="_blank"><img src="/icons/email.svg" width="20" height="20"/></a>
                
            </div>
        </div>
        <hr/>
        <div class="main">
    <h1>Making a programming language Part 3 - adding features</h1>
    
        <time>2012-08-31</time>
    
    
    
    <hr/>
    <p><a href="/posts/2012-08-29-creating-a-language-1">Table of
contents</a>, 
<a href="https://github.com/edofic/scrat-lang">Whole project on github</a></p>
<p>So now I have a repl that can evaluate stuff like</p>
<pre><code>(2+3)*(7/2-1)
</code></pre>
<p>Not much of a <a href="http://en.wikipedia.org/wiki/Programming_language" title="Programming language">programming language</a></p>
<ul>
<li>more like a calculator, and not even a good one. Lets add some
features!</li>
</ul>
<h3 id="constants">Constants</h3>
<p>Like pi, e and such. I have to change the grammar to match identifiers too.</p>
<p>Now I have</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> factor<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Expression</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> number <span style="color:#f92672">|</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#f92672">~&gt;</span> expr <span style="color:#f92672">&lt;~</span> <span style="color:#e6db74">&#34;)&#34;</span><span style="color:#f92672">)</span>
</code></pre></td></tr></table>
</div>
</div><p>And I change that to</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> factor<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Expression</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> value <span style="color:#f92672">|</span> parenExpr
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Expression</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> number <span style="color:#f92672">|</span> identifier
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> identifier<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Identifier</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#e6db74">&#34;[a-zA-Z]\\w*&#34;</span><span style="color:#f92672">.</span>r <span style="color:#f92672">^^</span> <span style="color:#f92672">{</span>
  s <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Identifier</span><span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></td></tr></table>
</div>
</div><p>and I also added a new token type</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Identifier</span><span style="color:#f92672">(</span>id<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Expression</span>
</code></pre></td></tr></table>
</div>
</div><p>and enabled this in evaluator\</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Identifier</span><span style="color:#f92672">(</span>name<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">StdLib</span><span style="color:#f92672">(</span>name<span style="color:#f92672">)</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>v<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Double</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> v
    <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SemanticError</span><span style="color:#f92672">(</span>name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; not found&#34;</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></td></tr></table>
</div>
</div><p>StdLib is just a map object. I went the python way - variables(and
constants) are entries in a global dictionary. Just a decision I made
while implementing this. As I said, I don&rsquo;t have a plan, I don&rsquo;t know
what I&rsquo;m doing and I don&rsquo;t know how stuff is done. How hard can it be?!
(<a href="http://www.bbc.co.uk/topgear/" title="Top Gear (2002 TV series)">Top Gear</a>
anyone?)</p>
<h3 id="exponentiation">Exponentiation</h3>
<p>Another math feature. It&rsquo;s more of a test for myself to see if I
understand grammars. Especially how to make a grammar not
<a href="http://en.wikipedia.org/wiki/Left_recursion" title="Left recursion">left-recursive</a>.
Because apparently such grammars don&rsquo;t work with
<a href="http://en.wikipedia.org/wiki/Recursive_descent_parser" title="Recursive descent parser">RDP</a>.
I turned out I don&rsquo;t understand grammars.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> exponent<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Expression</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#f92672">(</span>value <span style="color:#f92672">|</span> parenExpr<span style="color:#f92672">)</span> <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;^&#34;</span> <span style="color:#f92672">~</span> <span style="color:#f92672">(</span>value <span style="color:#f92672">|</span> parenExpr<span style="color:#f92672">)</span> <span style="color:#f92672">^^</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> a <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;^&#34;</span> <span style="color:#f92672">~</span> b <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Exponent</span><span style="color:#f92672">(</span>a<span style="color:#f92672">,</span>b<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> factor<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Expression</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">(</span>value <span style="color:#f92672">|||</span> exponent<span style="color:#f92672">)</span> <span style="color:#f92672">|</span> parenExpr
</code></pre></td></tr></table>
</div>
</div><p>The <code>|||</code> operator is an ugly hack. It tries both sides and returns the
longer match. By the time I was writing this I didn&rsquo;t know that order is
importat. If I just wrote <code>exponent | value</code> it would have worked, because
expoenent would match a value anyway and then failed on missing <code>^</code>.</p>
<p>Token and evaluation(uses <code>math.pow</code>) for this are quite trivial.</p>
<h3 id="function-calls">Function calls</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExpList</span><span style="color:#f92672">(</span>lst<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Expression</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Expression</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FunctionCall</span><span style="color:#f92672">(</span>name<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Identifier</span><span style="color:#f92672">,</span> args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ExpList</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Expression</span>
</code></pre></td></tr></table>
</div>
</div><p>Simple: function call is a name and list of expressions to evaluate for
arguments(wrapped because even an expression list is an expression)</p>
<p>Parser:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala">  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> arglist<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">ExpList</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#f92672">~&gt;</span> list <span style="color:#f92672">&lt;~</span> <span style="color:#e6db74">&#34;)&#34;</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> functionCall<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">FunctionCall</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> identifier <span style="color:#f92672">~</span> arglist <span style="color:#f92672">^^</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> id <span style="color:#f92672">~</span> args <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">FunctionCall</span><span style="color:#f92672">(</span>id<span style="color:#f92672">,</span> args<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Parser</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Expression</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> number <span style="color:#f92672">|</span> <span style="color:#f92672">(</span>identifier <span style="color:#f92672">|||</span> functionCall<span style="color:#f92672">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Again, I was having trouble - parser just didn&rsquo;t work and resorted to <code>|||</code>.
<code>functionCall</code> should come before identifier.</p>
<p>Evaluating this is more interesting. I decided to make functions be
values too for obvious reasons -&gt; <a href="http://en.wikipedia.org/wiki/Higher-order_function" title="Higher-order function">higher order
functions</a>(I&rsquo;m
into functional programming, remember?). So function values must be
stored in same &ldquo;namespace&rdquo;. <code>StdLib</code>(the only &ldquo;namespace&rdquo;) required to
become of type <code>Map[String,Any]</code>. I will have to do pattern matching
anyway since this will be dynamic-typed language. (Yes this is a plan, I
think it&rsquo;s easier to implement. <a href="http://en.wikipedia.org/wiki/Type_system">Static
typing</a> ftw, but
that&rsquo;s next project). And I needed a type for function values to pattern
match on - I went with <code>Any=&gt;Any</code> and sending in List(arg0,arg1,&hellip;)
doing more pattern matching inside the function. Will be slow but
hey&hellip;dynamic typing!</p>
<p>from evaluator</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">case</span> <span style="color:#a6e22e">FunctionCall</span><span style="color:#f92672">(</span>name<span style="color:#f92672">,</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">StdLib</span><span style="color:#f92672">(</span>name<span style="color:#f92672">.</span>id<span style="color:#f92672">)</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">FunctionVarArg</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> f<span style="color:#f92672">.</span>apply<span style="color:#f92672">(</span>apply<span style="color:#f92672">(</span>args<span style="color:#f92672">))</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">None</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ScratSemanticError</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;function &#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;not found&#34;</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></td></tr></table>
</div>
</div><p>and and example function in StdLib\</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">FunctionVarArg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Any</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Any</span>
<span style="color:#66d9ef">lazy</span> <span style="color:#66d9ef">val</span> ln<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">FunctionVarArg</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span>d<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Double</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">:</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Nil</span> <span style="color:#f92672">=&gt;</span> math<span style="color:#f92672">.</span>log<span style="color:#f92672">(</span>d<span style="color:#f92672">)</span>
  <span style="color:#66d9ef">case</span> other <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">ScratInvalidTypeError</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;expected single double but got &#34;</span> <span style="color:#f92672">+</span> other<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="conclusion">Conclusion</h3>
<p>As clearly illustrated above, not planning your grammar results in
constant changes in many places. So if you&rsquo;re doing something serious
just make the whole fricking grammar on a whiteboard beforehand.
Seriously. </p>
<p>Anyway..now I still only have a calculator, but a much more powerful
one. I can write expressions like \</p>
<pre><code>e^piln(10+2)1+2*3/4^5-log(e)
</code></pre>
<p>But that&rsquo;s nearly not enough. I want to be Touring-complete an ideally
to be able to compile/interpret itself.\</p>
<p><strong>next: <a href="/posts/2012-09-01-creating-a-language4">Hello World(strings, printing and interpreter)</a></strong></p>

    <hr/>
    
        <p>Last modified on 2012-08-31</p>
    
    
        <a href="/posts/2012-08-30-creating-a-language-2/">
            Previous Making a programming language Part 2 - something that kinda works
        </a>
    
    <br/>
    
    <a href="/posts/2012-09-01-creating-a-language4/">
        Next Making a programming language Part 4 - Hello World
    </a>
    

        </div>
        <script src="/js/instantclick.min.js" data-no-instant></script>
        <script data-no-instant>InstantClick.init("mousedown");</script>
    </body>
</html>
