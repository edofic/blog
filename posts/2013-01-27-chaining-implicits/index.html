<!DOCTYPE html>
<html><head>
<title>Chaining implicit conversion in scala</title>

<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">




<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>



<link rel="stylesheet" href="/scss/journal.min.9d1b3d6c4f3ff1773fff9bdca1bc24452f33129e12f67f2ab14f2ddaf1603468.css" media="screen">

<script src="/js/loadCSS.js"></script>
<script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>

</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    <div class="a-block nav-head false">
        <div class="nav-title">
            My Programming Escapades
        </div>
        <div class="nav-subtitle">
            
                Andraz Bajt
            
        </div>
            
                <a href="https://github.com/edofic"><img src="/icons/github.svg" width="20"/></a>
            
            
                <a href="https://www.linkedin.com/in/edofic"><img src="/icons/linkedin.svg" width="20"/></a>
            
            
                <a href="https://twitter.com/edofic"><img src="/icons/twitter.svg" width="20"/></a>
            
            <a href="/index.xml"><img src="/icons/rss.svg" width="20"/></a>
            
                <a href="mailto:edofic@edofic.com"><img src="/icons/email.svg" width="20"/></a>
            
    </div>


    <div class="nav-link-list">
        
        
            
            
            <a class="a-block nav-link-item" href="/about">
                About Me
            </a>
        
            
            
            <a class="a-block nav-link-item" href="/">
                Archive
            </a>
        
    </div>

    <div class="nav-footer">
        &copy;
    2020
	
	Andraz Bajt
	

    </div>

</div>
<div ref="extraContainer" class="extra-container">
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
    </div>
</div><div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
        
        
            
                
                
                <a class="a-block drawer-menu-item" href="/about">
                    About Me
                </a>
        
            
                
                
                    
                
                <a class="a-block drawer-menu-item" href="/">
                    Archive
                </a>
        
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="/">
            My Programming Escapades
        </a>
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
        <a href="/">
            <div class="single-column-header-title">My Programming Escapades</div>
            
            <div class="single-column-header-subtitle">Andraz Bajt</div>
            
        </a>

        
            <a href="https://github.com/edofic"><img src="/icons/github.svg" width="20"/></a>
        
        
            <a href="https://www.linkedin.com/in/edofic"><img src="/icons/linkedin.svg" width="20"/></a>
        
        
            <a href="https://twitter.com/edofic"><img src="/icons/twitter.svg" width="20"/></a>
        
        <a href="/index.xml"><img src="/icons/rss.svg" width="20"/></a>
        
            <a href="mailto:edofic@edofic.com"><img src="/icons/email.svg" width="20"/></a>
        

</div>

            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                 style="background-image: url('/')">
                <div class="post-title">
                    Chaining implicit conversion in scala
                    <div class="post-meta">
                        
                            <time itemprop="datePublished">
                                2013-01-27
                            </time>
                        

                        

                        
                    </div>
                </div>
            </div>

            <div class="post-body-wrapper">
                <div class="post-body">
                    <p>Today I was hanging
in the
#<a href="http://www.scala-lang.org/" title="Scala (programming language)">scala</a>
<a href="http://en.wikipedia.org/wiki/Internet_Relay_Chat" title="Internet Relay Chat">IRC
channel</a>
and somebody came along(forgot the nick, sorry) and asked about some
<a href="http://en.wikipedia.org/wiki/Compilation_error" title="Compilation error">compilation
error</a>.
I deduced he was trying to chain implicit conversions. And this doesn't
work. Else compilation would take forever and would also compile some
wrong code by inserting long strings of implicits. But then somebody
else responded(I think nick started with d) and gave a solution to
implicit chaining. But I'm not giving it away yet, you'll have to read a
bit more.</p>
<h3 id="the-problem">The problem</h3>
<p>Let's say I have some
<a href="http://en.wikipedia.org/wiki/Class_%28computer_programming%29" title="Class (computer programming)">classes</a>
that just add semantics to values(think labeled boxes)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Foo</span><span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Bar</span><span style="color:#f92672">(</span>b<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Baz</span><span style="color:#f92672">(</span>c<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span>
</code></pre></div><p>And because they look similar we may want to do some <a href="http://en.wikipedia.org/wiki/Type_conversion" title="Type conversion">implicit
conversion</a>.
Let's say that that's needed is conversion from Bar to Foo and from Baz
to Bar.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> bar2foo<span style="color:#f92672">(</span>bar<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Bar</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Foo</span><span style="color:#f92672">(</span>bar<span style="color:#f92672">.</span>b<span style="color:#f92672">)</span>
<span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> baz2bar<span style="color:#f92672">(</span>baz<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Baz</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Bar</span><span style="color:#f92672">(</span>baz<span style="color:#f92672">.</span>c<span style="color:#f92672">)</span>
</code></pre></div><p>On a level this also implies that Baz can be seen as Foo. But when you
try it</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">println<span style="color:#f92672">(</span>foo<span style="color:#f92672">.</span>a<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>bar<span style="color:#f92672">.</span>a<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>baz<span style="color:#f92672">.</span>a<span style="color:#f92672">)</span>
</code></pre></div><p>you get a compile error</p>
<pre><code>Implicits.scala:18: error: value a is not a member of Implicits.Baz
println(baz.a)
^
one error found
</code></pre>
<h3 id="the-solution">The solution</h3>
<p>As said, scala
<a href="http://en.wikipedia.org/wiki/Compiler" title="Compiler">compiler</a> doesn't try
to traverse the graph of implicit conversions and therefore doesn't
figure out how to insert needed conversions here. But here lies a handy
catch. What if the conversion wasn't from Bar to Foo but from something
Bar-like to Foo. Then the compiler would know that this chaining is
intended and is (probably) not a dead end. Good news: scala lets you
express that. It's called a view bound. You make the method generic and
limit input type to something that can be seen(implicitly converted to)
as a Bar. Here's the code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> bar2foo<span style="color:#f92672">[</span><span style="color:#66d9ef">T</span> <span style="color:#66d9ef">&lt;%</span> <span style="color:#66d9ef">Bar</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span>bar<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">T</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Foo</span><span style="color:#f92672">(</span>bar<span style="color:#f92672">.</span>b<span style="color:#f92672">)</span>
</code></pre></div><p>All the magic lies in the <code>&lt;%</code> operator. That's the view bound. When you
type <code>baz.a</code> the compiler sees that a property is available on the Foo
class and that there's an implicit conversion to Foo from something
Bar-like. Fortunately there's a conversion from Baz to Bar in scope so
it can invoke the method. Inside the method it tries to get the b
property from baz but it's not available. So it checks the conversions
and sees that a conversion from Baz to Bar exists in the scope and it
satisfies the need for b. It inserts this conversions and compilation
happily chucks along.</p>
<p><img src="/images/chaining-implicits/all_the.jpg" alt="Nest all the implicit conversions!"></p>
<p>Please don't do that.
Implicits can make code hard to read even without nesting. So use with
care. Scala is a very powerful language but great power comes with great
responsibility.</p>

                    <HR width="100%">
                    
                    <p style="color:#777;">Last modified on 2013-01-27</p>
                    
                </div>

            </div>


            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/2013-01-27-750-words/">
                    Next<br>750 words
                </a>
                

                
                <a class="older-posts" href="/posts/2013-01-27-generic-singletons/">
                    Previous<br>Generic singletons through dependent method types
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                



            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">&copy;
    2020
	
	Andraz Bajt
	
</div>
    	</div>
    <script src="//js/journal.js"></script>
    </body>
</html>
