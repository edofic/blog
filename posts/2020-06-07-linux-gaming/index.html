<!doctype html><html>
<head>
<title>Surprising ease of gaming on Linux in 2020</title>
<meta charset=utf-8>
<meta name=X-UA-Compatible content="IE=edge">
<meta name=google-site-verification content>
<meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport>
<style>body{max-width:800px;margin:auto;line-height:1.6;font-size:18px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}.nav a,.nav a:visited,.nav a:hover,.nav a:active{color:inherit}.nav .title{margin:0}.nav-sub{display:inline-block}.nav-item{margin:5px}.nav-sub-right{display:inline-block;float:right}.nav-icon{margin-right:5px}.main img{display:block;max-width:100%;margin:auto}.main pre{overflow:auto}" media="screen"></style>
</head>
<body>
<div class=nav>
<a href=/><h2 class=title>Andra≈æ Bajt's blog</h2></a>
<div class=nav-sub>
<a class=nav-item href=/about>
About Me
</a>
<a class=nav-item href=/>
Archive
</a>
</div>
<div class=nav-sub-right>
<a class=nav-icon href=https://github.com/edofic target=_blank><img src=/icons/github.svg width=20 height=20></a>
<a class=nav-icon href=https://www.linkedin.com/in/edofic target=_blank><img src=/icons/linkedin.svg width=20 height=20></a>
<a class=nav-icon href=https://twitter.com/edofic target=_blank><img src=/icons/twitter.svg width=20 height=20></a>
<a class=nav-icon href=/index.xml target=_blank><img src=/icons/rss.svg width=20 height=20></a>
<a class=nav-icon href=mailto:blog@edofic.com target=_blank><img src=/icons/email.svg width=20 height=20></a>
</div>
</div>
<hr>
<div class=main>
<h1>Surprising ease of gaming on Linux in 2020</h1>
<time>2020-06-07</time>
<hr>
<p>During the quarantine my hobbies (and I imagine many others') shifted to more
indoors ones - possibly sedentary. Among other things I also started gaming
after a hiatus of many years.</p>
<p>But as you can probably imagine gaming on a 13" laptop with integrated graphics
is not the most gratifying of experiences. So I got myself a desktop with a
proper graphics card.</p>
<p>And now comes the interesting part: since all the games I originally planned on
playing have Linux support I decided to skip buying a copy of Windows and copy
my laptop <a href=https://nixos.org/>NixOS</a> config and extend it as needed. Basically
I wanted to do some tinkering again.</p>
<h1 id=nvidia>NVidia</h1>
<p>The aforementioned graphics card is made by NVidia. And I braced for a world of
pain to set it up - the image of Linus flipping off the GPU giant still fresh in
my memory (actually it&rsquo;s been a while - that <a href="https://www.phoronix.com/scan.php?page=news_item&px=MTEyMTc">happened in
2012</a>)</p>
<p><img src=/images/linus-nvidia.png alt="linus flipping off nvidia"></p>
<p>And I recently heard a friend rant about NVidia driver / Steam compatibility
issues on Ubuntu. But the amazing Nix community had my back on this. Drives are
nicely packaged - I just needed to <a href=https://github.com/edofic/dotfiles/commit/b06aaa734bcc45e07e5c1e450494241aa11a4109#diff-c82c2d31640fd1352de397c99bfcda0cR191>enable
them</a></p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-nix data-lang=nix>services<span style=color:#f92672>.</span>xserver<span style=color:#f92672>.</span>videoDrivers <span style=color:#960050;background-color:#1e0010>=</span> [ <span style=color:#e6db74>&#34;nvidia&#34;</span> ];
</code></pre></td></tr></table>
</div>
</div><h1 id=steam>Steam</h1>
<p>Next up is my preferred distribution platform - Steam. Still have an account
(and some games) from my previous gaming sting. The steam installed also does
quite a bit of magic usually so this had me a bit worried as well. But
apparently I&rsquo;m not the first first person (by far!) to try gaming on NixOS as
it&rsquo;s beautifully packaged. Just need to <a href=https://github.com/edofic/dotfiles/commit/b06aaa734bcc45e07e5c1e450494241aa11a4109#diff-c82c2d31640fd1352de397c99bfcda0cR112>add it to system
packages</a>
and <em>everything</em> works out of the box.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-nix data-lang=nix>environment<span style=color:#f92672>.</span>systemPackages <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#66d9ef>with</span> pkgs; [
  <span style=color:#f92672>...</span>
  steam
  <span style=color:#f92672>...</span>
];
</code></pre></td></tr></table>
</div>
</div><p>Games install and play. I can get myself entertained, story over. Right?</p>
<h1 id=steam-play--proton--wine>Steam Play / Proton / Wine</h1>
<p>I incidentally learned about Steam Play (marketing name) / Proton (OSS name).
Valve created <a href=https://github.com/ValveSoftware/Proton>a tool</a> to run
Windows-only games on Linux - basically Wine + (a lot of) tricks. And apparently
it works quite good. There is even <a href=https://www.protondb.com/>protondb.com</a> - a
database of playability reports so you can tell what works and what doesn&rsquo;t
<em>before</em> buying games.</p>
<p>And the best surprise? This is seamlessly integrated into Steam client. So I
picked I AAA (windows-only!) game I liked, clicked install, clicked play.</p>
<p>AND EVERYTHING WORKED!</p>
<p>I was running a AAA game via Wine on NixOS on a NVidia card. Butter smooth. I
was&mldr;still am&mldr;very impressed by this.</p>
<p>Even a random controller-only early access game worked through this setup. Very
nice. Speaking of controllers&mldr;</p>
<h1 id=playstation4-dualshock4>PlayStation4 DualShock4</h1>
<p>I tried some games on an old cheap controller that I had. It worked but it was
not great. I want to get myself something better. After a (literally) 2min search
I concluded that DS4 should work on Linux without too much trouble and I bought
one.</p>
<p>And it did work fine - over USB. Steam also comes with a driver for it comoplete
with configuration panel. Sorry about this post turning into a bit of an ad for
Steam but I am genuinely impressed.</p>
<p>But of course I wanted to go wireless. Proprietary drivers over bluetooth on
Linux on a funky distro. This will not end well. But I said I wanted tinkering.</p>
<p>I already had <a href=https://github.com/edofic/dotfiles/blob/afc0e990dd65c80b9233944d2af8ac19d637ee8e/nixos/desktop.nix#L55-L57>bluetooth config</a> from my laptop</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-nix data-lang=nix>hardware<span style=color:#f92672>.</span>bluetooth <span style=color:#960050;background-color:#1e0010>=</span> {
  enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
  package <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>bluezFull;
};
</code></pre></td></tr></table>
</div>
</div><p>and a BT dongle for my PC. Almost a bit surprisingly it detected the controller
and successfully paired. But it showed up as a generic device. And here comes
the first bump on this journey: Steam drivers did not pick it up - and it was
unusable.</p>
<p>Long story short - after about an hour of research and trying things I added
<a href=https://github.com/edofic/dotfiles/blob/afc0e990dd65c80b9233944d2af8ac19d637ee8e/nixos/desktop.nix#L55-L57>this udev rules</a> to enable Steam to have permissions to use the device.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-nix data-lang=nix>services<span style=color:#f92672>.</span>udev<span style=color:#f92672>.</span>extraRules <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#e6db74>&#39;&#39;
</span><span style=color:#e6db74>  # DualShock 4 over bluetooth hidraw
</span><span style=color:#e6db74>  KERNEL==&#34;hidraw*&#34;, KERNELS==&#34;*054C:05C4*&#34;, MODE=&#34;0666&#34;
</span><span style=color:#e6db74>&#39;&#39;</span>;
</code></pre></td></tr></table>
</div>
</div><p>And that&rsquo;s it. All the tinkering required. I can now use a DS4 over BT for AAA
Windows only games on NixOS. Based on my anecdotal evidence NixOS is now a
better (easier) plafform for gaming than Windows. But my criteria might be a bit
skewed ;)</p>
<hr>
<p>Last modified on 2020-06-07</p>
<a href=/posts/2020-04-20-rebase-rename/>
Previous Rename rebase with git
</a>
<br>
<a href=/posts/2020-10-17-attach-to-k8s/>
Next Attaching your local machine to a Kubernetes cluster
</a>
</div>
</body>
</html>