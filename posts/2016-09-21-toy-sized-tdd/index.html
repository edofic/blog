<!doctype html><html><head><title>TDD-ing a toy sized project</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><style>body{max-width:800px;margin:auto;line-height:1.6;font-size:18px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}.nav a,.nav a:visited,.nav a:hover,.nav a:active{color:inherit}.nav .title{margin:0}.nav-sub{display:inline-block}.nav-item{margin:5px}.nav-sub-right{display:inline-block;float:right}.nav-icon{margin-right:5px}.main img{display:block;max-width:100%;margin:auto}.main pre{overflow:auto}" media="screen"></style></head><body><div class=nav><a href=/><h2 class=title>Andra≈æ Bajt's blog</h2></a><div class=nav-sub><a class=nav-item href=/about/>About Me</a>
<a class=nav-item href=/>Archive</a></div><div class=nav-sub-right><a class=nav-icon href=https://github.com/edofic target=_blank><img src=/icons/github.svg width=20 height=20></a>
<a class=nav-icon href=https://www.linkedin.com/in/edofic target=_blank><img src=/icons/linkedin.svg width=20 height=20></a>
<a class=nav-icon href=https://twitter.com/edofic target=_blank><img src=/icons/twitter.svg width=20 height=20></a>
<a class=nav-icon href=/index.xml target=_blank><img src=/icons/rss.svg width=20 height=20></a>
<a class=nav-icon href=mailto:blog@edofic.com target=_blank><img src=/icons/email.svg width=20 height=20></a></div></div><hr><div class=main><h1>TDD-ing a toy sized project</h1><time>2016-09-21</time><hr><p>Just recently I was porting a toy sized parser combinator library (a proof of
concept) from Haskell to Python. You know, for educational purposes. It turns
out I&rsquo;m not smart enough to keep the complicated types (and explicit laziness)
in my head even for such a small project. So my solution was to do TDD. To
clarify: I wanted to test happy paths through my functions to make sure at
least types fit together.</p><p>So tests I will write. But that means I need another file for tests (yes, it
was I single file project, that&rsquo;s what I mean with &ldquo;toy-sized&rdquo;), some actual
structure, a test runner, probably a package description for dependencies&mldr;
How about no? I remembered seeing a thing called <code>doctest</code> once. Turns out it
fit perfectly!.</p><p>This is how using <code>doctest</code> looks in Python:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parseString</span>(target):
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &gt;&gt;&gt; parseString(&#39;foo&#39;)(&#39;foobar&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  [(&#39;foo&#39;, &#39;bar&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>p</span>(s):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> s<span style=color:#f92672>.</span>startswith(target):
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> [(target, s[len(target):])]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>import</span> doctest
</span></span><span style=display:flex><span>  doctest<span style=color:#f92672>.</span>testmod()
</span></span></code></pre></td></tr></table></div></div><p>And then run with <code>python myfile.py</code>. It is that simple (and built-int). You
just put examples in the docstring and they will be machine checked.</p><p>But I&rsquo;m lazy and don&rsquo;t want to run tests every time by hand. I want a
poor-man&rsquo;s runner with <code>--watch</code> capability. And I can have it as a bash
one-liner (given that <code>inotify-tools</code> package is installed on my system).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  inotifywait myfile.py
</span></span><span style=display:flex><span>  clear
</span></span><span style=display:flex><span>  python myfile.py
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></td></tr></table></div></div><p>This will automatically clear the screen and re-run tests every time I change
the file - save it from my editor. Now I can finally develop my toy projects in
split screen with terminal and vim using only my editor&rsquo;s save function to run
tests :)</p><h2 id=bonus-section>Bonus section</h2><p>Doctest is ported to Haskell, so I can use it there as well. Just need to
<code>stack install</code> it globally and it will be available for my one-file projects.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#75715e>-- |</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- &gt;&gt;&gt; parseNumber &#34;123&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- [(Number 123,&#34;&#34;),(Number 12,&#34;3&#34;),(Number 1,&#34;23&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseNumber</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Parser</span> <span style=color:#66d9ef>Expr</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parseNumber</span> <span style=color:#f92672>=</span> mapParser (<span style=color:#66d9ef>Number</span> <span style=color:#f92672>.</span> read <span style=color:#f92672>.</span> concat) <span style=color:#f92672>$</span> plus parseDigit
</span></span></code></pre></td></tr></table></div></div><p>And run with</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  inotifywait myfile.py
</span></span><span style=display:flex><span>  clear
</span></span><span style=display:flex><span>  doctest myfile.py
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></td></tr></table></div></div><hr><p>Last modified on 2016-09-21</p><a href=/posts/2016-02-24-git-repair/>Previous Repairing a corrupt Git repo using a clone</a><br><a href=/posts/2017-08-30-dockerless-services/>Next Dockerless Services (with Nix)</a></div><script src=/js/instantclick.min.js data-no-instant></script>
<script data-no-instant>InstantClick.init("mousedown")</script></body></html>