<!doctype html><html><head><title>TDD-ing a toy sized project</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/vendor/js/jquery.min.js></script><script src=/vendor/js/popper.min.js></script><script src=/vendor/js/bootstrap.min.js></script><script src=/vendor/js/smooth-scroll.polyfills.min.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><script src=/vendor/js/vue.min.js></script><link rel=stylesheet href=/scss/journal.min.3bdd3e0bba961aa48fdce1402e6f01783c435b4dfb0025c8d0022ddaea0f3d19.css media=screen><script src=/js/loadCSS.js></script><script>loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");</script></head><body><div id=app><div ref=sideContainer class=side-container><div class="a-block nav-head false"><div class=nav-title>My Programming Escapades</div><div class=nav-subtitle>Andraz Bajt</div><a href=https://github.com/edofic><img src=/icons/github.svg width=20></a>
<a href=https://www.linkedin.com/in/edofic><img src=/icons/linkedin.svg width=20></a>
<a href=https://twitter.com/edofic><img src=/icons/twitter.svg width=20></a>
<a href=/index.xml><img src=/icons/rss.svg width=20></a>
<a href=mailto:edofic@edofic.com><img src=/icons/email.svg width=20></a></div><div class=nav-link-list><a class="a-block nav-link-item" href=/about>About Me</a>
<a class="a-block nav-link-item" href=/>Archive</a></div><div class=nav-footer>&copy;
2020
Andraz Bajt</div></div><div ref=extraContainer class=extra-container><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a></div></div><div class=single-column-drawer-container ref=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item" href=/about>About Me</a>
<a class="a-block drawer-menu-item" href=/>Archive</a></div></div></div><transition name=fade><div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav ref=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div ref=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a ref=navTitle class=navbar-brand href=/>My Programming Escapades</a></div></nav><div class=single-column-header-container ref=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=/><div class=single-column-header-title>My Programming Escapades</div><div class=single-column-header-subtitle>Andraz Bajt</div></a><a href=https://github.com/edofic><img src=/icons/github.svg width=20></a>
<a href=https://www.linkedin.com/in/edofic><img src=/icons/linkedin.svg width=20></a>
<a href=https://twitter.com/edofic><img src=/icons/twitter.svg width=20></a>
<a href=/index.xml><img src=/icons/rss.svg width=20></a>
<a href=mailto:edofic@edofic.com><img src=/icons/email.svg width=20></a></div><div id=content><div ref=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only style="background-image:url('/')"><div class=post-title>TDD-ing a toy sized project<div class=post-meta><time itemprop=datePublished>2016-09-21</time></div></div></div><div class=post-body-wrapper><div class=post-body><p>Just recently I was porting a toy sized parser combinator library (a proof of
concept) from Haskell to Python. You know, for educational purposes. It turns
out I'm not smart enough to keep the complicated types (and explicit laziness)
in my head even for such a small project. So my solution was to do TDD. To
clarify: I wanted to test happy paths through my functions to make sure at
least types fit together.</p><p>So tests I will write. But that means I need another file for tests (yes, it
was I single file project, that's what I mean with &ldquo;toy-sized&rdquo;), some actual
structure, a test runner, probably a package description for dependencies&mldr;
How about no? I remembered seeing a thing called <code>doctest</code> once. Turns out it
fit perfectly!.</p><p>This is how using <code>doctest</code> looks in Python:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parseString</span>(target):
  <span style=color:#e6db74></span><span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>  &gt;&gt;&gt; parseString(</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>foo</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>)(</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>foobar</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>)</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>  [(</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>foo</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>, </span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>bar</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>)]</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>  </span><span style=color:#e6db74>&#34;&#34;&#34;</span>
  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>p</span>(s):
    <span style=color:#66d9ef>if</span> s<span style=color:#f92672>.</span>startswith(target):
      <span style=color:#66d9ef>return</span> [(target, s[len(target):])]
    <span style=color:#66d9ef>else</span>:
      <span style=color:#66d9ef>return</span> []
  <span style=color:#66d9ef>return</span> p


<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>__main__</span><span style=color:#e6db74>&#39;</span>:
  <span style=color:#f92672>import</span> doctest
  doctest<span style=color:#f92672>.</span>testmod()
</code></pre></div><p>And then run with <code>python myfile.py</code>. It is that simple (and built-int). You
just put examples in the docstring and they will be machine checked.</p><p>But I'm lazy and don't want to run tests every time by hand. I want a
poor-man's runner with <code>--watch</code> capability. And I can have it as a bash
one-liner (given that <code>inotify-tools</code> package is installed on my system).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span>
  inotifywait myfile.py
  clear
  python myfile.py
<span style=color:#66d9ef>done</span>
</code></pre></div><p>This will automatically clear the screen and re-run tests every time I change
the file - save it from my editor. Now I can finally develop my toy projects in
split screen with terminal and vim using only my editor's save function to run
tests :)</p><h2 id=bonus-section>Bonus section</h2><p>Doctest is ported to Haskell, so I can use it there as well. Just need to
<code>stack install</code> it globally and it will be available for my one-file projects.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=color:#75715e>-- |</span>
<span style=color:#75715e>-- &gt;&gt;&gt; parseNumber &#34;123&#34;</span>
<span style=color:#75715e>-- [(Number 123,&#34;&#34;),(Number 12,&#34;3&#34;),(Number 1,&#34;23&#34;)]</span>
<span style=color:#a6e22e>parseNumber</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Parser</span> <span style=color:#66d9ef>Expr</span>
<span style=color:#a6e22e>parseNumber</span> <span style=color:#f92672>=</span> mapParser (<span style=color:#66d9ef>Number</span> <span style=color:#f92672>.</span> read <span style=color:#f92672>.</span> concat) <span style=color:#f92672>$</span> plus parseDigit
</code></pre></div><p>And run with</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span>
  inotifywait myfile.py
  clear
  doctest myfile.py
<span style=color:#66d9ef>done</span>
</code></pre></div><hr width=100%><p style=color:#777>Last modified on 2016-09-21</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2017-08-30-dockerless-services/>Next<br>Dockerless Services (with Nix)</a>
<a class=older-posts href=/posts/2016-02-24-git-repair/>Previous<br>Repairing a corrupt Git repo using a clone</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=single-column-footer>&copy;
2020
Andraz Bajt</div></div><script src=//js/journal.js></script></body></html>