<!doctype html><html><head><title>NixOS install & labor pains</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/vendor/js/jquery.min.js></script><script src=/vendor/js/popper.min.js></script><script src=/vendor/js/bootstrap.min.js></script><script src=/vendor/js/smooth-scroll.polyfills.min.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><script src=/vendor/js/vue.min.js></script><link rel=stylesheet href=/scss/journal.min.3bdd3e0bba961aa48fdce1402e6f01783c435b4dfb0025c8d0022ddaea0f3d19.css media=screen><script src=/js/loadCSS.js></script><script>loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");</script></head><body><div id=app><div ref=sideContainer class=side-container><div class="a-block nav-head false"><div class=nav-title>My Programming Escapades</div><div class=nav-subtitle>Andraz Bajt</div><a href=https://github.com/edofic><img src=/icons/github.svg width=20></a>
<a href=https://www.linkedin.com/in/edofic><img src=/icons/linkedin.svg width=20></a>
<a href=https://twitter.com/edofic><img src=/icons/twitter.svg width=20></a>
<a href=/index.xml><img src=/icons/rss.svg width=20></a>
<a href=mailto:edofic@edofic.com><img src=/icons/email.svg width=20></a></div><div class=nav-link-list><a class="a-block nav-link-item" href=/about>About Me</a>
<a class="a-block nav-link-item" href=/>Archive</a></div><div class=nav-footer>&copy;
2021
Andraz Bajt</div></div><div ref=extraContainer class=extra-container><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a></div></div><div class=single-column-drawer-container ref=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item" href=/about>About Me</a>
<a class="a-block drawer-menu-item" href=/>Archive</a></div></div></div><transition name=fade><div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav ref=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div ref=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a ref=navTitle class=navbar-brand href=/>My Programming Escapades</a></div></nav><div class=single-column-header-container ref=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=/><div class=single-column-header-title>My Programming Escapades</div><div class=single-column-header-subtitle>Andraz Bajt</div></a><a href=https://github.com/edofic><img src=/icons/github.svg width=20></a>
<a href=https://www.linkedin.com/in/edofic><img src=/icons/linkedin.svg width=20></a>
<a href=https://twitter.com/edofic><img src=/icons/twitter.svg width=20></a>
<a href=/index.xml><img src=/icons/rss.svg width=20></a>
<a href=mailto:edofic@edofic.com><img src=/icons/email.svg width=20></a></div><div id=content><div ref=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only style="background-image:url('/')"><div class=post-title>NixOS install & labor pains<div class=post-meta><time itemprop=datePublished>2018-01-24</time></div></div></div><div class=post-body-wrapper><div class=post-body><h1 id=the-back-story>The Back Story</h1><p>My first foray into world of Linux happened with Red Hat Linux 6 (original, not
the enterprise one). It was magical but it didn&rsquo;t stick. See, I was a kid who
liked video games. So it was back to Windows until I finally got serious about
programming and discovered I the development environment on Linux. So I
formatted my hard drive and installed Ubuntu. I quickly learned absorbed
information and slowly got bored. When Unity came out it was time to switch. I
dabbled a bit with Mint but ultimately landed on ArchLinux. I really like the
<em>RTFM or GTFO</em> philosophy of Arch because it means you learn stuff and you
learn it quickly. Because you just have to. Oh, and there is great
documentation. And everything was great. Until I borked my system doing an
upgrade or some other system package operation. A few times. Btrfs to the
rescue! But there must be a better way. (I was doing manual snapshots of the
root filesystem before any potentially destructive operation.</p><p>Then I heard my colleagues talking about this amazing package manager called
Nix and the derived distribution - <a href=https://nixos.org>NixOS</a>. It&rsquo;s tag lines
are (respectively:</p><blockquote><p>The Purely Functional Package Manager</p></blockquote><p>and</p><blockquote><p>The Purely Functional Linux Distribution</p></blockquote><h1 id=the-install>The Install</h1><p>Being the Haskell geek I am, I needed to give it a spin. I tried the Virtual
Box image but it was weird. It has KDE and I couldn&rsquo;t really figure out how to
alter it. So I decided to just try to do a fresh install in Virtual Box.</p><p>Turns out the manual pretty much has you covered. It&rsquo;s not Arch Wiki level, but
good enough to set up a minimal install without any major issues.</p><p>At this point I was so fascinated by the core concepts that I just bit the
bullet - I decided to install it onto my physical machine. What could possibly
go wrong?</p><p>So I just created a quick subvolume (Btrfs again!) and rebooted. About half an
hour later I had a working NixOS install alongside my Arch. It was really
minimal but I was happy and I built on it quickly. A few evenings of playing
around later I just switched. I set up pretty much the same environment I had
before so my work productivity didn&rsquo;t suffer a bit. If anything it was better -
now I no longer feared system upgrades because rollback had my back.</p><h1 id=the-crash>The Crash</h1><p>And then it happened. My hard drive failed and there were issues with the
external backup as well. I managed to recover data but not the system. No
biggie - NixOS is trivial to rebuild from the config file. Or so I thought. I
had to locally rebuild the world, starting from <code>glibc</code>. (I think it was my
error for using an old boot image.) That took pretty much the whole day.</p><p>So I devised plan for re-installs which I tested out and I&rsquo;m now documenting
here for future usage:</p><ol><li>download fresh <code>nixos-unstable</code> image</li><li>boot it and install minimal system with network manager</li><li>boot into the new system</li><li>update channels</li><li>fetch personal config</li><li>rebuild</li></ol><p>With this approach I&rsquo;m up and running an exact replica of the system in about
half an hour. Yup, my hard drive crashed again. This time my backup was fine but
I decided to actually go this route to test out the procedure. Works like a
charm. And I also did it when a bought a new computer. It&rsquo;s kind of creepy when
after half an hour you are greeted by a familiar desktop on an unfamiliar
hardware. Creepy but very cool.</p><hr width=100%><p style=color:#777>Last modified on 2018-01-24</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2018-01-25-jira-gsheet/>Next<br>Integrating Jira into Google Sheets</a>
<a class=older-posts href=/posts/2017-09-01-scala-tuple-apply/>Previous<br>Implementing apply on tuples in Scala</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=single-column-footer>&copy;
2021
Andraz Bajt</div></div><script src=//js/journal.js></script></body></html>