<!doctype html><html><head><title>Cool Monday - HList and Shapeless</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/vendor/js/jquery.min.js></script><script src=/vendor/js/popper.min.js></script><script src=/vendor/js/bootstrap.min.js></script><script src=/vendor/js/smooth-scroll.polyfills.min.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><script src=/vendor/js/vue.min.js></script><link rel=stylesheet href=/scss/journal.min.3bdd3e0bba961aa48fdce1402e6f01783c435b4dfb0025c8d0022ddaea0f3d19.css media=screen><script src=/js/loadCSS.js></script><script>loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");</script></head><body><div id=app><div ref=sideContainer class=side-container><div class="a-block nav-head false"><div class=nav-title>My Programming Escapades</div><div class=nav-subtitle>Andraz Bajt</div><a href=https://github.com/edofic><img src=/icons/github.svg width=20></a>
<a href=https://www.linkedin.com/in/edofic><img src=/icons/linkedin.svg width=20></a>
<a href=https://twitter.com/edofic><img src=/icons/twitter.svg width=20></a>
<a href=/index.xml><img src=/icons/rss.svg width=20></a>
<a href=mailto:edofic@edofic.com><img src=/icons/email.svg width=20></a></div><div class=nav-link-list><a class="a-block nav-link-item" href=/about>About Me</a>
<a class="a-block nav-link-item" href=/>Archive</a></div><div class=nav-footer>&copy;
2021
Andraz Bajt</div></div><div ref=extraContainer class=extra-container><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a></div></div><div class=single-column-drawer-container ref=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item" href=/about>About Me</a>
<a class="a-block drawer-menu-item" href=/>Archive</a></div></div></div><transition name=fade><div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav ref=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div ref=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a ref=navTitle class=navbar-brand href=/>My Programming Escapades</a></div></nav><div class=single-column-header-container ref=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=/><div class=single-column-header-title>My Programming Escapades</div><div class=single-column-header-subtitle>Andraz Bajt</div></a><a href=https://github.com/edofic><img src=/icons/github.svg width=20></a>
<a href=https://www.linkedin.com/in/edofic><img src=/icons/linkedin.svg width=20></a>
<a href=https://twitter.com/edofic><img src=/icons/twitter.svg width=20></a>
<a href=/index.xml><img src=/icons/rss.svg width=20></a>
<a href=mailto:edofic@edofic.com><img src=/icons/email.svg width=20></a></div><div id=content><div ref=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only style="background-image:url('/')"><div class=post-title>Cool Monday - HList and Shapeless<div class=post-meta><time itemprop=datePublished>2012-10-29</time></div></div></div><div class=post-body-wrapper><div class=post-body><p>HList as in
<a href=http://en.wikipedia.org/wiki/Homogeneity_and_heterogeneity title="Homogeneity and heterogeneity">heterogenous</a>
lists. This means every element is of different type. Yeah sure, just
list List in Java, but that is in no way typesafe. I want compiler to know the
type of every element and stop me if I try to do something silly.</p><h3 id=linked-lists-to-the-rescue>Linked lists to the rescue</h3><p>So what's a <a href=http://en.wikipedia.org/wiki/Linked_list title="Linked list">linked
list</a> anyway? A
sequence of nodes with pointers to next. And a nice implementation(still
talking
<a href=http://www.oracle.com/technetwork/java/ title="Java (programming language)">Java</a>
here) would be generic to allow
<a href=http://en.wikipedia.org/wiki/Type_safety title="Type safety">type-safety</a>
forÂ homogeneous lists. It turns out generics are solution for HLists too.
Just introduce additional <a href=http://en.wikipedia.org/wiki/TypeParameter title=TypeParameter>type
parameter</a>.
Apocalisp has a <a href=http://apocalisp.wordpress.com/2008/10/23/heterogeneous-lists-and-the-limits-of-the-java-type-system/>great
post</a>
on implementing them in Java.
Java requires A LOT of <a href=http://en.wikipedia.org/wiki/Type_signature title="Type signature">type
annotation</a>.
It works but it's just painful and it doesn't pay off.</p><h3 id=type-inferencehttpenwikipediaorgwikitype-inference-type-inference-to-the-rescue><a href=http://en.wikipedia.org/wiki/Type_inference title="Type inference">Type inference</a> to the rescue</h3><p>Type inference gets rid of this problem entirely. Let's implement whole
working HList in scala.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>H</span>,<span style=color:#66d9ef>T</span><span style=color:#66d9ef>&lt;:</span><span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span>,<span style=color:#66d9ef>_</span><span style=color:#f92672>]</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>def</span> head<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>H</span>
    <span style=color:#66d9ef>def</span> tail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span>  <span style=color:#66d9ef>def</span> <span style=color:#66d9ef>::</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span><span style=color:#f92672>(</span>a<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Hcons</span><span style=color:#f92672>(</span>a<span style=color:#f92672>,</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>HNil</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Nothing</span>, <span style=color:#66d9ef>Nothing</span><span style=color:#f92672>]</span><span style=color:#f92672>{</span>
    <span style=color:#66d9ef>def</span> head <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>IllegalAccessException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;head of empty hlist&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>def</span> tail <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>IllegalAccessException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;tail of empty hlist&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Hcons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>H</span>,<span style=color:#66d9ef>T</span><span style=color:#66d9ef>&lt;:</span><span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span>,<span style=color:#66d9ef>_</span><span style=color:#f92672>]</span><span style=color:#f92672>]</span><span style=color:#f92672>(</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> head<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>H</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> tail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>H</span>, <span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</code></pre></div><p>So this list can be instantiated like this</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>val</span> myHList <span style=color:#66d9ef>=</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>:</span><span style=color:#66d9ef>:</span> <span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#66d9ef>hi</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#66d9ef>::</span> <span style=color:#960050;background-color:#1e0010>2</span><span style=color:#66d9ef>.</span><span style=color:#960050;background-color:#1e0010>0</span> <span style=color:#66d9ef>::</span> <span style=color:#66d9ef>HNil</span>
myHList<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Hcons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span>,<span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>java</span><span style=color:#66d9ef>.</span><span style=color:#66d9ef>lang</span><span style=color:#66d9ef>.</span><span style=color:#66d9ef>String</span>,<span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span>,<span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Nothing</span>,<span style=color:#66d9ef>Nothing</span><span style=color:#f92672>]</span><span style=color:#f92672>]</span><span style=color:#f92672>]</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>Hcons</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span><span style=color:#a6e22e>Hcons</span><span style=color:#f92672>(</span>hi<span style=color:#f92672>,</span><span style=color:#a6e22e>Hcons</span><span style=color:#f92672>(</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>,</span><span style=color:#a6e22e>HNil</span>$<span style=color:#a6e22e>@dbb62c</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span>
</code></pre></div><p>And it just works. Scala compiler does all the heavy lifting with type
annotations. This implementation bare bones and doesn't provide any
useful methods(even random access!). Check out Miles Sabin's <a href=https://github.com/milessabin/shapeless>shapeless
project</a> for a useful
implementation and much more. I provides indexing, map, fold,
concatenation, type-safe casts, conversions to tuples(and abstracting
over arities!) and back. And even conversions with case classes. Just
click the link above and read the readme. It's awesome.</p><hr width=100%><p style=color:#777>Last modified on 2012-10-29</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2012-11-02-web-framework/>Next<br>Hunt for a web framework that works</a>
<a class=older-posts href=/posts/2012-10-29-design-patterns-bullshit/>Previous<br>Design patterns are bullshit!</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=single-column-footer>&copy;
2021
Andraz Bajt</div></div><script src=//js/journal.js></script></body></html>