<!doctype html><html><head><title>Cool Monday - HList and Shapeless</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><link rel=stylesheet href=/scss/main.min.31cac6fb291c18037123c54900f92aaa75653b03bf9d6b70a2fd0565930494e3.css media=screen></head><body><div class=nav><a href=/><h2 class=title>Andraž Bajt's blog</h2></a><div class=nav-sub><a class=nav-item href=/about>About Me</a>
<a class=nav-item href=/>Archive</a></div><div class=nav-sub-right><a class=nav-icon href=https://github.com/edofic target=_blank><img src=/icons/github.svg width=20></a>
<a class=nav-icon href=https://www.linkedin.com/in/edofic target=_blank><img src=/icons/linkedin.svg width=20></a>
<a class=nav-icon href=https://twitter.com/edofic target=_blank><img src=/icons/twitter.svg width=20></a>
<a class=nav-icon href=/index.xml target=_blank><img src=/icons/rss.svg width=20></a>
<a class=nav-icon href=mailto:blog@edofic.com target=_blank><img src=/icons/email.svg width=20></a></div></div><hr><div class=main><h1>Cool Monday - HList and Shapeless</h1><time>2012-10-29</time><hr><p>HList as in
<a href=http://en.wikipedia.org/wiki/Homogeneity_and_heterogeneity title="Homogeneity and heterogeneity">heterogenous</a>
lists. This means every element is of different type. Yeah sure, just
list List in Java, but that is in no way typesafe. I want compiler to know the
type of every element and stop me if I try to do something silly.</p><h3 id=linked-lists-to-the-rescue>Linked lists to the rescue</h3><p>So what&rsquo;s a <a href=http://en.wikipedia.org/wiki/Linked_list title="Linked list">linked
list</a> anyway? A
sequence of nodes with pointers to next. And a nice implementation(still
talking
<a href=http://www.oracle.com/technetwork/java/ title="Java (programming language)">Java</a>
here) would be generic to allow
<a href=http://en.wikipedia.org/wiki/Type_safety title="Type safety">type-safety</a>
for homogeneous lists. It turns out generics are solution for HLists too.
Just introduce additional <a href=http://en.wikipedia.org/wiki/TypeParameter title=TypeParameter>type
parameter</a>.
Apocalisp has a <a href=http://apocalisp.wordpress.com/2008/10/23/heterogeneous-lists-and-the-limits-of-the-java-type-system/>great
post</a>
on implementing them in Java.
Java requires A LOT of <a href=http://en.wikipedia.org/wiki/Type_signature title="Type signature">type
annotation</a>.
It works but it&rsquo;s just painful and it doesn&rsquo;t pay off.</p><h3 id=type-inferencehttpenwikipediaorgwikitype_inference-type-inference-to-the-rescue><a href=http://en.wikipedia.org/wiki/Type_inference title="Type inference">Type inference</a> to the rescue</h3><p>Type inference gets rid of this problem entirely. Let&rsquo;s implement whole
working HList in scala.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-scala data-lang=scala><span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>H</span>,<span style=color:#66d9ef>T</span><span style=color:#66d9ef>&lt;:</span><span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span>,<span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>def</span> head<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>H</span>
    <span style=color:#66d9ef>def</span> tail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span>  <span style=color:#66d9ef>def</span> <span style=color:#66d9ef>::</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>a<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Hcons</span><span style=color:#f92672>(</span>a<span style=color:#f92672>,</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>HNil</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Nothing</span>, <span style=color:#66d9ef>Nothing</span><span style=color:#f92672>]{</span>
    <span style=color:#66d9ef>def</span> head <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>IllegalAccessException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;head of empty hlist&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>def</span> tail <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>IllegalAccessException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;tail of empty hlist&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Hcons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>H</span>,<span style=color:#66d9ef>T</span><span style=color:#66d9ef>&lt;:</span><span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span>,<span style=color:#66d9ef>_</span><span style=color:#f92672>]](</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> head<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>H</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> tail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>H</span>, <span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</code></pre></td></tr></table></div></div><p>So this list can be instantiated like this</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>val</span> myHList <span style=color:#66d9ef>=</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>:</span><span style=color:#66d9ef>:</span> <span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#66d9ef>hi</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#66d9ef>::</span> <span style=color:#960050;background-color:#1e0010>2</span><span style=color:#66d9ef>.</span><span style=color:#960050;background-color:#1e0010>0</span> <span style=color:#66d9ef>::</span> <span style=color:#66d9ef>HNil</span>
myHList<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Hcons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span>,<span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>java.lang.String</span>,<span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span>,<span style=color:#66d9ef>HList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Nothing</span>,<span style=color:#66d9ef>Nothing</span><span style=color:#f92672>]]]]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>Hcons</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span><span style=color:#a6e22e>Hcons</span><span style=color:#f92672>(</span>hi<span style=color:#f92672>,</span><span style=color:#a6e22e>Hcons</span><span style=color:#f92672>(</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>,</span><span style=color:#a6e22e>HNil</span>$<span style=color:#a6e22e>@dbb62c</span><span style=color:#f92672>)))</span>
</code></pre></td></tr></table></div></div><p>And it just works. Scala compiler does all the heavy lifting with type
annotations. This implementation bare bones and doesn&rsquo;t provide any
useful methods(even random access!). Check out Miles Sabin&rsquo;s <a href=https://github.com/milessabin/shapeless>shapeless
project</a> for a useful
implementation and much more. I provides indexing, map, fold,
concatenation, type-safe casts, conversions to tuples(and abstracting
over arities!) and back. And even conversions with case classes. Just
click the link above and read the readme. It&rsquo;s awesome.</p><hr><p>Last modified on 2012-10-29</p><a href=/posts/2012-10-29-design-patterns-bullshit/>Previous Design patterns are bullshit!</a><br><a href=/posts/2012-11-02-web-framework/>Next Hunt for a web framework that works</a></div></body></html>