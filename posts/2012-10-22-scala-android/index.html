<!doctype html><html><head><title>Setting up for scala development on Android</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/journal.min.01c37d732f853bf90329007dc6f0a25c67722dd47b7168f8907facb93414bd91.css media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons"></head><body><div id=app><div ref=sideContainer class=side-container><div class="a-block nav-head false"><div class=nav-title>Andraž Bajt's blog</div><div class=nav-subtitle></div><a href=https://github.com/edofic><img src=/icons/github.svg width=20></a>
<a href=https://www.linkedin.com/in/edofic><img src=/icons/linkedin.svg width=20></a>
<a href=https://twitter.com/edofic><img src=/icons/twitter.svg width=20></a>
<a href=/index.xml><img src=/icons/rss.svg width=20></a>
<a href=mailto:edofic@edofic.com><img src=/icons/email.svg width=20></a></div><div class=nav-link-list><a class="a-block nav-link-item" href=/about>About Me</a>
<a class="a-block nav-link-item" href=/>Archive</a></div><div class=nav-footer>&copy;
2021
Andraz Bajt</div></div><div ref=extraContainer class=extra-container><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a></div></div><div class=single-column-drawer-container ref=drawer><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item" href=/about>About Me</a>
<a class="a-block drawer-menu-item" href=/>Archive</a></div></div></div><div class=single-column-header-container ref=pageHead><a href=/><div class=single-column-header-title>Andraž Bajt's blog</div></a><a href=https://github.com/edofic><img src=/icons/github.svg width=20></a>
<a href=https://www.linkedin.com/in/edofic><img src=/icons/linkedin.svg width=20></a>
<a href=https://twitter.com/edofic><img src=/icons/twitter.svg width=20></a>
<a href=/index.xml><img src=/icons/rss.svg width=20></a>
<a href=mailto:edofic@edofic.com><img src=/icons/email.svg width=20></a></div><div id=content><div ref=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only style="background-image:url('/')"><div class=post-title>Setting up for scala development on Android<div class=post-meta><time itemprop=datePublished>2012-10-22</time></div></div></div><div class=post-body-wrapper><div class=post-body><p><a href=http://www.crunchbase.com/product/android><img src=http://www.crunchbase.com/assets/images/resized/0001/4601/14601v1-max-450x450.png alt="Image representing Android as depicted in Crun&mldr;"></a></p><p><a href=http://en.wikipedia.org/wiki/File%3AScala_logo.png><img src=http://upload.wikimedia.org/wikipedia/en/thumb/8/85/Scala_logo.png/300px-Scala_logo.png alt="Scala (programming language)"></a></p><p>I&rsquo;ve been developing for android more than a year now and a few months
in scala. So naturally I wanted to combine the two. But it&rsquo;s not dead
simple. This is kinda a tutorial an a reference if I ever forget how to
do this. It took me a few days to figure it all out. I tried maven, ant
with special config and sbt(I need to learn more about this one) but in
the end I just wanted fast solution integrated into my IDE.</p><p>So I use <a href=http://www.jetbrains.com/idea/ title="IntelliJ IDEA">IntelliJ
IDEA</a> community edition
for my IDE.  You should check it out, it&rsquo;s totally awesome. It&rsquo;s primary
a Java IDE but scala plugin rocks. It offers some more advanced text
editing capabilities, not like vim or emacs but enough for me. It also
brings up coloring and editing features that are language aware. So you
have a shortcut(Ctrl-W) to select semantically valid block. And press it
again to expand to next bigger valid piece of code. And stuff like
that. Real-time structure view is nice and there are some cool
refactorings. But scala
<a href=http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop title="Read–eval–print loop">REPL</a>
is where fun begins. You get your module classpath pre-set and you get
<strong>full editor capabilities in REPL</strong>. Enough with advertisement(they
didn&rsquo;t pay me to do this) and let&rsquo;s get to work. </p><h3 id=prerequisites>Prerequisites</h3><ul><li>JDK&mldr;duh!  I use
<a href=http://openjdk.java.net/projects/jdk7/ title=OpenJDK>OpenJDK</a> 7, IDEA
gives some warnings but it works like a charm</li><li><a href=http://en.wikipedia.org/wiki/Android_software_development title="Android software development">Android
SDK</a>
and at least one platform</li><li>IntelliJ IDEA</li><li>scala distribution. I recommend you use latest stable release from
<a href=http://www.scala-lang.org/downloads>here</a> </li></ul><h3 id=setting-up>Setting up</h3><p>First install scala plugin. It&rsquo;s quite straightforward. Plugin
Manager->Browse repos->search for scala->select->ok.</p><p>Now actual setting up. I use global libraries for all my projects, you
can also put these into just Libraries and to that on per-project basis.</p><p>Open project structure(no project open) and go to Global Libraries. You
need to create two libraries containing jars from /lib/.</p><p>First scala-compiler
with scala-compiler.jar and scala-library.jar and then scala-library
with scala-library.jar and anything else you might need. Reason for
scala library in compiler is that compiler also relies on scala lib. I
needed quite some time to figure this out.</p><p>This whole process can be automated if you add scala to your project
when creating it but it&rsquo;s not possible with android so you need to know
how to do it by hand. </p><h3 id=creating-a-project>Creating a project</h3><ul><li>Project from scratch</li><li>add android module and configure it</li><li>now go to project structure. add scala facet to this module and go
to its settings and set the compiler jar.</li><li>back to module and add dependency to global scala-library</li><li>set dependency to <strong>provided</strong>. This is important. Else it will try
to dex whole library and you&rsquo;ll end up with &ldquo;too  many methods
error&rdquo;.</li></ul><p>Now your project should compile. But not run.</p><h3 id=running>Running</h3><p>Obviously not including scala library in the build means you need to
provide it in another way. For developing on emulator I customized it to
provide predexed scala library. <a href=http://zegoggl.es/2011/07/how-to-preinstall-scala-on-your-android-phone.html>Excellent
tutorial.</a></p><p>In a nutshell</p><pre><code>$ git clone git://github.com/jberkel/android-sdk-scala.git$ cd android-sdk-scala$ ./bin/createdexlibs
$ bin/createramdisks
$ emulator -avd ... -ramdisk /path/to/custom.img$ adb shell mkdir -p /data/framework$ for i in configs/framework/*.jar; do adb push $i /data/framework/; done
</code></pre><p>And reboot.</p><p>There is also (not so trivial) part about patching a device. However you
can try <a href="https://play.google.com/store/apps/details?id=com.mobilemagic.scalainstaller&feature=search_result#?t=W251bGwsMSwxLDEsImNvbS5tb2JpbGVtYWdpYy5zY2FsYWluc3RhbGxlciJd">Scala
Installer</a> from
Play to do this. I had some success and some failures.</p><p>Now the app should run on your device.</p><h3 id=deploying>Deploying</h3><p>Well it doesn&rsquo;t work on other devices right now. For export you need to
change scala-library dependency back to <strong>compile</strong>to include it into
the build. Trick now is to enable ProGuard to remove unnecessary methods
and classed to fit the jar through dexer. You do this in
Tools-><a href=http://code.google.com/android/ title=Android>Android</a>->Export.
Select ProGuard and your config. I got mine from jberkel&rsquo;s repo. That&rsquo;s
it. Sadly this export takes quite some time. Scala&rsquo;s standard library is
not a piece of cake afterall(actually <em>it is</em> a cake). Minute and a
half on my machine for small apps. So I only to this for testing on
other phones and deployment.</p><h3 id=faster-compilation>Faster compilation</h3><p>Compiling with scala-libray set to provided is much faster but not fast
enough for me. I want to be doing stuff not <a href=http://xkcd.com/303/>waiting for it to
compile</a>. </p><p>Turns out compiler is the big time sucker(and I&rsquo;m being Capt. Obvious).
Afterall scalac is not known for it&rsquo;s speed.</p><p>Enter <strong>FSC</strong>or Fast Scala Compiler. This is a scala compiler running in
the background having everything preloaded and just does incremental
compilation. It even comes with standard scala distribution and is
supported by IntelliJ IDEA. Great. </p><p>To set it up just head over to Project Structure->Scala facet and
select Use FSC. And then immediately click Setting to access Project
Settings and set compiler jar for the compiler.</p><p>Success. Scala builds are now on par(or even faster!) than java ones. </p><p>No more fencing for me.</p><hr width=100%><p style=color:#777>Last modified on 2012-10-22</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2012-10-29-design-patterns-bullshit/>Next<br>Design patterns are bullshit!</a>
<a class=older-posts href=/posts/2012-10-21-javascript-ftl/>Previous<br>Javascript faster than light! (well C actually)</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=single-column-footer>&copy;
2021
Andraz Bajt</div></div></body></html>