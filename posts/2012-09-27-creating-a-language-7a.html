---
title: Making a programming language: Part 7a - objects
---

<div><a style="background-color: white; color: #888888; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 13px; line-height: 18px; text-decoration: none;" href="http://edofic.blogspot.com/2012/08/making-programming-language-part-1-how.html" target="_blank">Table of contents</a><span style="background-color: white; color: #222222; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 13px; line-height: 18px;">, </span><a style="background-color: white; color: #888888; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 13px; line-height: 18px; text-decoration: none;" href="https://github.com/edofic/scrat-lang" target="_blank">Whole project on github</a></div>
<div></div>
My goal in this post is for this to compile
<pre>func create(n){this}</pre>
and a call to it to return a reference to an <a title="Object (computer science)" href="http://en.wikipedia.org/wiki/Object_%28computer_science%29" target="_blank" rel="wikipedia">object</a> that contains "n".

Functions are a bit different from the rest of the language. Not by <a title="Implementation" href="http://en.wikipedia.org/wiki/Implementation" target="_blank" rel="wikipedia">implementation</a> or usage but by <a title="Thought" href="http://en.wikipedia.org/wiki/Thought" target="_blank" rel="wikipedia">thought process</a> behind designing them. I actually thought about objects and <a title="Function (mathematics)" href="http://en.wikipedia.org/wiki/Function_%28mathematics%29" target="_blank" rel="wikipedia">functions</a> before implementing any of them. Considering my implementation of scopes(which I like) and shadowing I got this great idea that functions, scopes and objects are just many faces of the same thing. Or "could be" many faces of the same thing. Something a bit more powerful than a function being the "thing".

Let's see how that works. A function in this language needs a new <a title="Local variable" href="http://en.wikipedia.org/wiki/Local_variable" target="_blank" rel="wikipedia">local scope</a> for every execution(not all functions, but this is a simplification because I don't care about performance, see <a href="http://edofic.blogspot.com/2012/09/making-programming-language-part-6.html" target="_blank">previous post</a> for details). New scope. New something. New. Bells should be ringing right now. I'm creating objects. I could just as well pass the reference to that object. I even have the reference. It's current scope - "this" in scala code. So I just need a <a title="Language construct" href="http://en.wikipedia.org/wiki/Language_construct" target="_blank" rel="wikipedia">language construct</a> to access that. How about "this".
<pre>//in SScope body
map.put("this", this)</pre>
Not even a language construct, just a magic variable. You can even shadow it.
Anticlimactic? I hope so. The whole point of object is that it's just another view on function.

I could end the post here but I want to show why this is awesome(and therefore why I'm proud of it)
<h3>Privates</h3>
<div>You don't even need access modifiers, you can use shadowing and nesting
<pre>func private(n) {
    that = this
    func (){ 
        func get() { that.n }
        func set(v) { that.n = v }
        this
    }()
}</pre>
This is a constructor that returns an object with functions get and set(but no n!). Outer object is available through its alias via nesting. And returned value is the last expression - an immediately invoked lambda(cumbersome syntax..gotta do something about that).
However, this is not bullet-proof
<pre>o = private(1)
o.that = func(){
           n=3
           this
         }
o.get()</pre>
Returns 3. Though knowledge of implementation is needed to execute such attack.

<b>update: </b> I kinda sorta forgot to include how I made that dot-access thingy-o.get() to work. Continuation below

<b>next: </b><a href="http://edofic.blogspot.com/2012/10/making-programming-language-part-7b.html" target="_blank">using objects</a>

</div>